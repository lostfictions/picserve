<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Here are some things</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #000;
      color: #fff;
      position: absolute;
      overflow-x: hidden;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial;
    }

    .wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wrapper img {
      /*width: 100%;*/
      width: 100vw;
      object-fit: contain;
    }

    .wrapper a {
      color: #fff;
      text-decoration: none;
    }

    ::-webkit-scrollbar {
      width: 3px;
    }

    ::-webkit-scrollbar-track {
      -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0,0,255,0.5);
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <!--<a>-->
      <img>
    <!--</a>-->
  </div>
  <script>
    var slideshowWaitTime = 5000

    var i = document.querySelector('.wrapper img')
    // var link = qs('.wrapper a')
    var imgs
    var ind = 0
    var cover = false
    var doSlideshow = true
    var slideshowTimeout

    document.onmousemove = updateSlideshowTimeout

    window.addEventListener("keydown", function(event) {
      if(event.defaultPrevented) {
        return
      }
      switch(event.code) {
        case "ArrowLeft":
          prevImage()
          break
        case "Space":
        case "ArrowRight":
          nextImage()
          break
        case "KeyC":
          cover = !cover
          updateCover()
          break
        case "KeyP":
          doSlideshow = !doSlideshow
          console.log("Slideshow: " + (doSlideshow ? 'ON' : 'OFF'))
          updateSlideshowTimeout()
          break
        default:
          return
      }
      event.preventDefault()
    }, true)

    function handleImageList(imageList) {
      imgs = imageList
      updateImage()
    }

    function nextImage() {
      ind = ind + 1
      if(ind >= imgs.length) {
        ind = 0
      }
      updateImage()
    }

    function prevImage() {
      ind = ind - 1
      if(ind < 0) {
        ind = imgs.length - 1
      }
      updateImage()
    }

    function updateSlideshowTimeout() {
      if(slideshowTimeout) {
        clearTimeout(slideshowTimeout)
        slideshowTimeout = undefined
      }
      if(doSlideshow) {
        console.log('setting timeout....')
        slideshowTimeout = setTimeout(function() { slideshowTimeout = undefined; nextImage() }, slideshowWaitTime)
      }
    }

    function updateCover() {
      i.style.height = cover ? 'inherit' : '100vh'
    }

    function updateImage() {
      cover = false
      updateCover()
      updateSlideshowTimeout()
      i.setAttribute('src', imgs[ind])
      i.setAttribute('title', imgs[ind].substr('/images/'.length).split('/').join(' - '))
    }
  </script>
  <script type="application/javascript" src="/imagelist?callback=handleImageList"></script>
</body>

</html>
